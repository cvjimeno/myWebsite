---
// src/components/career/AlternatingTimelineItem.astro (The Final, Complete Version)
import { Image } from 'astro:assets';

export interface Props {
  id: string;
  logoSrc: any;
  logoAlt: string;
  role: string;
  institutionName: string;
  institutionColorClass?: string;
  dates: string;
  descriptionLines: string[];
  skills?: string[];
  illustrations?: any[];
  textOnRight: boolean;
  isLastItem?: boolean;
}

const { id, illustrations, ...item } = Astro.props;
const {
  role, institutionName, institutionColorClass, dates, descriptionLines, skills,
  logoSrc, logoAlt, textOnRight, isLastItem
} = item;
---
<li id={id} class="timeline-item relative group">
  <!-- Main container for layout -->
  <div class="relative md:grid md:grid-cols-2 md:gap-x-16 items-center w-full pl-32 md:pl-0 py-10">
    
    <!-- Text Block -->
    <div class:list={[ "md:py-4", { 'md:order-last md:text-left': textOnRight }, { 'md:text-right': !textOnRight } ]}>
      <h3 class:list={[ "text-xl md:text-2xl font-bold mb-1", institutionColorClass ]}>{institutionName}</h3>
      <p class="text-lg font-medium text-text-primary mb-4">{role}</p>
      <div class="date-badge inline-block bg-bg-secondary text-text-secondary text-sm font-semibold px-3 py-1 mb-6 rounded-md border border-border-card">{dates}</div>
      <div class="prose prose-sm sm:prose-base text-text-secondary max-w-none space-y-3 mb-6">
        {descriptionLines.map(line => <p set:html={line} />)}
      </div>
      <div class:list={[ "flex flex-wrap gap-2", { "md:justify-end": !textOnRight } ]}>
        {skills?.map(skill => (
          <span class="text-xs font-medium bg-bg-secondary dark:bg-bg-primary px-3 py-1.5 rounded-full border border-border-card">{skill}</span>
        ))}
      </div>
    </div>
    
    <!-- Illustration/Photo Collage (Desktop only) -->
    <div class:list={[ "hidden md:flex items-center", { "justify-start": textOnRight }, { "justify-end": !textOnRight } ]}>
       {illustrations && illustrations.length > 0 && (
          <div class="illustration-collage relative w-80 h-56">
            {illustrations.slice(0, 3).map((illust, index) => (
              <div class:list={[
                "p-1.5 bg-bg-card rounded-md shadow-lg border border-border-card",
                `collage-img-${index}`
              ]}>
                <Image src={illust} alt="" width={120} height={120} class="rounded-sm w-full h-full object-cover" />
              </div>
            ))}
          </div>
        )}
    </div>
  </div>
  
  <!-- Centerline elements -->
  <div class="absolute top-0 left-10 md:left-1/2 -translate-x-1/2 h-full w-0.5 bg-border-subtle/40 -z-10" aria-hidden="true"></div>
  <div class="absolute top-10 left-10 md:left-1/2 -translate-x-1/2">
    <div class="logo-dot w-20 h-20 bg-bg-card border-4 border-bg-primary dark:border-bg-secondary rounded-full flex items-center justify-center transition-transform duration-300 ease-in-out">
      <Image src={logoSrc} alt={logoAlt} width={48} height={48} class="object-contain" />
    </div>
  </div>
</li>

<style>
  .timeline-item.is-active .logo-dot {
    transform: scale(1.25);
  }

  .illustration-collage {
    transition: filter 0.5s ease-in-out;
    filter: grayscale(100%);
  }
  .timeline-item.is-illustrations-active .illustration-collage {
    filter: grayscale(0%);
  }

  /* Base positions for collage items */
  .collage-img-0, .collage-img-1, .collage-img-2 {
    position: absolute;
    transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
  }

  /* Initial (overlapping, rotated) positions */
  .collage-img-0 {
    top: 0;
    left: 60px;
    transform: rotate(-12deg) scale(0.95);
    z-index: 1;
  }
  .collage-img-1 {
    bottom: 16px;
    left: 0;
    transform: rotate(3deg) scale(0.95);
    z-index: 2;
  }
  .collage-img-2 {
    top: 32px;
    right: 0;
    transform: rotate(10deg) scale(0.9);
    z-index: 0;
  }

  /* When illustrations active: disperse, remove rotation, scale up */
  .timeline-item.is-illustrations-active .collage-img-0 {
    left: -10px;
    top: -10px;
    transform: rotate(0deg) scale(1.1);
  }
  .timeline-item.is-illustrations-active .collage-img-1 {
    left: 80px;
    top: 70px;
    transform: rotate(0deg) scale(1.1);
  }
  .timeline-item.is-illustrations-active .collage-img-2 {
    right: -10px;
    top: 20px;
    transform: rotate(0deg) scale(1.1);
  }
</style>