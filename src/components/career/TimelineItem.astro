---
// src/components/career/TimelineItem.astro
import { Image } from 'astro:assets';

export interface Props {
  logoSrc: any;
  logoAlt: string;
  role: string;
  institutionName: string;
  institutionColorClass?: string;
  dates: string;
  descriptionLines: string[];
  ctaLink?: string;
  ctaText?: string;
  isLastItem?: boolean;
}

const {
  logoSrc: logo,
  logoAlt,
  role,
  institutionName,
  institutionColorClass = 'text-text-primary',
  dates,
  descriptionLines,
  ctaLink,
  ctaText,
  isLastItem = false,
} = Astro.props;

const hasCta = ctaLink && ctaText;
---

{/* The parent <li> is a simple flex row. Its children will now stretch to the same height. */}
<li class="flex gap-x-4 sm:gap-x-6">
  
  <!-- Column 1: Vertical Line & Logo -->
  {/* This is now a flex column, allowing us to position the logo and line within it. */}
  <div class="flex flex-col items-center w-16 md:w-20 flex-shrink-0">
    {/* This container gives the logo a fixed space at the top of the column. */}
    <div class="w-16 h-16 md:w-20 md:h-20 flex-shrink-0 flex items-center justify-center">
      {logo && (
        <Image
          src={logo}
          alt={logoAlt}
          width={80}
          height={80}
          format="webp"
          class="object-contain max-w-full max-h-[80%]"
        />
      )}
    </div>
    {/* THE FIX: If this is not the last item, we render the line. */}
    {/* 'flex-grow' tells the line to take up all available vertical space left by the logo. */}
    {!isLastItem && (
      <div class="flex-grow w-0.5 bg-border-subtle"></div> 
    )}
  </div>

  <!-- Column 2: Content (This column's height dictates the height of the whole <li>) -->
  <div class="flex-grow pt-1 pb-8"> 
    <h3 class="text-xl md:text-2xl font-semibold text-text-primary mb-1">
      {role}
      {institutionName && (
        <span class="font-semibold">
          {' en '}
          <span class:list={[institutionColorClass, 'font-bold']}>
            {institutionName}
          </span>
        </span>
      )}
    </h3>
    <p class="text-sm text-text-secondary mb-3">{dates}</p>

    <div class="prose prose-sm sm:prose-base text-text-secondary max-w-none space-y-3">
      {descriptionLines.map(line => (
        <p set:html={line} />
      ))}
    </div>

    {hasCta && (
      <div class="mt-4">
        <a
          href={ctaLink}
          class="inline-block px-5 py-2.5 bg-accent-primary text-white text-sm font-medium rounded-lg hover:bg-accent-primary-hover transition-colors"
        >
          {ctaText}
        </a>
      </div>
    )}
  </div>
</li>